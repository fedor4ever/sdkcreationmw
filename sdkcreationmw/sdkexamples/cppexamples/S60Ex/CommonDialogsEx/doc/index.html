<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>

<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CommonDialogsEx</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head>

<table border="0" width="100%" height="8" bgcolor="#eeeeee">
<tr> <td width="100%" height="1"><b><font size="2" color="#000000" face="Arial, Helvetica, sans-serif"><strong><a name=Top></a>
S60 5th Edition SDK v0.9 </strong></font></b><br><i>CommonDialogsEx</i></td></tr> </table>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>CommonDialogsEx</h1>
<p>
1. <a class="el" href="index.html#Intro_sec">About this Example</a><br>
2. <a class="el" href="index.html#Arch_sec">Architecture</a><br>
3. <a class="el" href="index.html#Design_sec">Design and Implementation</a><br>
<p>
<hr>
<h2><a class="anchor" name="Intro_sec">
1. About this Example</a></h2>
The CommonDialogsEx example demonstrates the usage of Common Dialogs APIs. This example mainly demonstrates how to use normal and Multiple Drive CFD APIs. This example covers the following operations:
<br>
<ul>
<li>opening the memory selection dialog</li>
<li>opening the memory settings dialog</li>
<li>opening a file selection dialog</li>
<li>opening a file name prompt dialog.</li>
</ul>
<h3><a class="anchor" name="Sub11">
1.1 APIs demonstrated</a></h3>
The CommonDialogsEx application mainly demonstrates the usage of the following APIs: <br>
 <br>
<ul>
<li><code>CAknMemorySelectionDialog::NewL()</code><br>
</li><li><code>CAknMemorySelectionDialog::ExecuteL()</code><br>
</li><li><code>CAknMemorySelectionDialogMultiDrive::NewL()</code><br>
</li><li><code>CAknMemorySelectionDialogMultiDrive:ExecuteL()</code><br>
</li><li><code>CAknFileSelectionDialog::NewL()</code><br>
</li><li><code>CAknFileSelectionDialog::ExecuteL()</code><br>
</li><li><code>CAknFileNamePromptDialog::RunDlgLD()</code><br>
 <br>
</li><li><code>CAknMemorySelectionSettingItem()</code><br>
</li><li><code>CAknMemorySelectionSettingItemMultiDrive()</code><br>
</li><li><code>CAknMemorySelectionSettingItem::ConstructL()</code><br>
</li><li><code>CAknMemorySelectionSettingItemMultiDrive::ConstructL()</code><br>
</li><li><code>CAknMemorySelectionSettingItem::ConstructL()</code><br>
</li><li><code>CAknMemorySelectionSettingItemMultiDrive::ConstructL()</code><br>
</li><li><code>CAknSettingItemArray::AppendL()</code><br>
</li><li><code>CAknSettingItemArray::RecalculateVisibleIndicesL()</code><br>
</li><li><code>CTextListBoxModel::SetItemTextArray()</code><br>
</li><li><code>CTextListBoxModel::SetOwnershipType()</code><br>
</li><li><code>CAknSettingStyleListBox::CreateScrollBarFrameL()</code><br>
</li><li><code>CAknSettingStyleListBox::ScrollBarFrame()</code><br>
</li><li><code>CAknSettingStyleListBox::HandleItemAdditionL()</code><br>
</li><li><code>CAknSettingStyleListBox::SetListBoxObserver()</code><br>
</li><li><code>CAknSettingStyleListBox::UpdateScrollBarsL()</code><br>
</li><li><code>CEikListBox::SetScrollBarVisibilityL();</code></li>
<li><code>CAknMemorySelectionSettingItem::EditItemL( )</code></li>
<li><code>CAknMemorySelectionSettingItemMultiDrive::EditItemL()</code><br>
</li></ul>
<p>
The following header files are included in the example:<br>
<p>
<ul>
<li><code>CAknMemorySelectionDialog.h</code><br>
</li><li><code>CAknMemorySelectionDialogMultiDrive.h</code><br>
</li><li><code>CAknMemorySelectionSettingPage.h</code><br>
</li><li><code>CAknFileSelectionDialog.h</code><br>
</li><li><code>CAknFileNamePromptDialog.h</code><br>
</li><li><code>AknSettingItemList.h</code><br>
</li><li><code>EikDialg.h</code><br>
 <br>
</li></ul>
<p>
The <a class="el" href="class_c_common_dialogs_ex_settings_dialog.html">CCommonDialogsExSettingsDialog</a> class is inherited from the following classes:<br>
<p>
<ul>
<li><code>CEikDialog</code><br>
</li><li><code>MEikListBoxObserver</code><br>
 <br>
</li></ul>
<p>
The following functions have been implemented:<br>
<p>
<ul>
<li><code>TBool OkToExitL( TInt aButtonId )</code><br>
</li><li><code>void PreLayoutDynInitL()</code><br>
</li><li><code>void ProcessCommandL( TInt aCommandId )</code><br>
</li><li><code>void HandleListBoxEventL( CEikListBox* aListBox,TListBoxEvent aEventType )</code><br>
 <br>

</li></ul>
 <hr>
<h3><a class="anchor" name="Sub12">
1.2 Prerequisites</a></h3>
This example requires a familiarity with the C++ programming language and S60 application structure.<p>
<hr>
<h2><a class="anchor" name="Arch_sec">
2. Architecture</a></h2>
The CommonDialogsEx example application follows the standard S60 application framework. The application, document and view classes implement the framework and the actual example code is in the <a class="el" href="class_c_common_dialogs_ex_app_ui.html">CCommonDialogsExAppUi</a> class.<h2><a class="anchor" name="Design_sec">
3. Design and Implementation</a></h2>
<h3><a class="anchor" name="Sub31">
3.1 Capabilities</a></h3>
The CommonDialogsEx application needs the <code>ReadUserData</code> and <code>WriteUserData</code> capabilities for creating, modifying and deleting contact(s).<h3><a class="anchor" name="Sub32">
3.2 Build and Installation</a></h3>
The CommonDialogsEx application has two <code>.pkg</code> files which will be used for making <code>.sis</code> packages for different target platforms. The whole project can be imported to the CodeWarrior IDE as an <code>.mmp</code> file. The project can be built in the CodeWarrior IDE. It can also be build on from the command line with the following commands:<p>
<div class="fragment"><pre class="fragment"> ..\group&gt;bldmake bldfiles
 ..\group&gt;abld build winscw udeb
</pre></div><h3><a class="anchor" name="Sub34">
3.3 Preparation</a></h3>
<p>When the application is started, the <a class="el" href="class_c_common_dialogs_ex_container.html">CCommonDialogsExContainer</a> class will be initialized by View class. Here are the steps done in <code>CCommonDialogsExContainer</code>'s constructor (the labels are two components for display text):</p>
<div class="fragment"><pre class="fragment">   iLabel = <span class="keyword">new</span> (ELeave) CEikLabel;
   iLabel-&gt;SetContainerWindowL( *<span class="keyword">this</span> );
   iLabel-&gt;SetTextL( _L(<span class="stringliteral">"Example View"</span>) );

   iToDoLabel = <span class="keyword">new</span> (ELeave) CEikLabel;
   iToDoLabel-&gt;SetContainerWindowL( *<span class="keyword">this</span> );
   iToDoLabel-&gt;SetTextL( _L(<span class="stringliteral">"Press Options to start"</span>) );
</pre></div><p>
<p>The <code>ShowTextL(const TDesC&amp; aText, const TDesC&amp; aTextSub)</code> function shows a text message on the screen by using label:</p>
<div class="fragment"><pre class="fragment">   iLabel-&gt;SetTextL(aText);
   iToDoLabel-&gt;SetTextL(aTextSub);
</pre></div><p>
When the application is launched the <a class="el" href="class_c_common_dialogs_ex_app_ui.html">CCommonDialogsExAppUi</a> class is initialized by the <code>AppUi</code> class. Here are the steps done in the constructor:<p>
<div class="fragment"><pre class="fragment"> iAppContainer = <span class="keyword">new</span> (ELeave) <a class="code" href="class_c_common_dialogs_ex_container.html">CCommonDialogsExContainer</a>;
 iAppContainer-&gt;ConstructL( ClientRect() );
</pre></div><p>
The <a class="el" href="class_c_common_dialogs_ex_settings_dialog.html">CCommonDialogsExSettingsDialog</a> class is inherited from the <code>CEikDialog</code> and <code>MEikListBoxObserver</code> classes. In this class you should implement function <code>PreLayoutDynInitL()</code> <code>OkToExitL()</code> <code>ProcessCommandL()</code> from <code>CEikDialog</code>, implement function <code>HandleListBoxEventL()</code> from <code>MEikListBoxObserver</code>.<p>
The <code>PreLayoutDynInitL()</code> function initializes the dialog's controls before the dialog is sized and layed out:<p>
<div class="fragment"><pre class="fragment">  CAknSettingStyleListBox* listBox =  static_cast&lt; CAknSettingStyleListBox* &gt;
                                                             ( Control( ECommonDialogsExSettingsListboxId ) );
   User::LeaveIfNull( listBox );
</pre></div><p>
Create the memory selection item (if your current SDK supports Multiple Drive APIs):<p>
<div class="fragment"><pre class="fragment">  <span class="keywordflow">if</span> ( iMultiDriveSupport )
       {    
       settingItem = <span class="keyword">new</span>( ELeave ) CAknMemorySelectionSettingItemMultiDrive(
                                            iResourceId, iDriveNumber );
       }
  <span class="keywordflow">else</span>
       {
       settingItem = <span class="keyword">new</span>( ELeave ) CAknMemorySelectionSettingItem(
                                           iResourceId, iMemory );
       }
   CleanupStack::PushL( settingItem );
</pre></div><p>
Set title for the memory selection item:<p>
<div class="fragment"><pre class="fragment">   itemTitle = iCoeEnv-&gt;AllocReadResourceLC( R_STRING_COMMONDIALOGSEX_SET_MEMORY );
   settingItem-&gt;ConstructL( EFalse, 0, *itemTitle, NULL, 0,
                                                   EAknCtPopupSettingList );
   CleanupStack::PopAndDestroy();  <span class="comment">// itemTitle</span>
</pre></div><p>
Add memo store item to the settings array:<p>
<div class="fragment"><pre class="fragment">   iSettingItemArray.AppendL( settingItem );
   CleanupStack::Pop();    <span class="comment">// settingItem</span>
</pre></div><p>
Set listBox:<p>
<div class="fragment"><pre class="fragment">   CTextListBoxModel* model = listBox-&gt;Model();
   model-&gt;SetItemTextArray( &amp;iSettingItemArray );
   model-&gt;SetOwnershipType( ELbmDoesNotOwnItemArray );
   iSettingItemArray.RecalculateVisibleIndicesL();
   listBox-&gt;CreateScrollBarFrameL( ETrue );
   listBox-&gt;ScrollBarFrame()-&gt;SetScrollBarVisibilityL(
                       CEikScrollBarFrame::EOff, CEikScrollBarFrame::EAuto );
   listBox-&gt;HandleItemAdditionL();
   listBox-&gt;SetListBoxObserver( <span class="keyword">this</span> );
   listBox-&gt;UpdateScrollBarsL();
</pre></div><h3><a class="anchor" name="Sub36">
3.5 Execution</a></h3>
<p>There are total of six cases for this example:</p>
<ol>
<li>opening memory selection dialog</li>
<li>opening Multiple Drive memory selection dialog</li>
<li>opening memory settings dialog</li>
<li>opening Multiple Drive memory settings dialog</li>
<li>opening file selection dialog</li>
<li>opening file name prompt dialog</li>
</ol>

(1) Creating memory selection dialogs with case <code>ECommonDialogsExCmd101</code>:<p>
<div class="fragment"><pre class="fragment">           CAknMemorySelectionDialog* dlg = CAknMemorySelectionDialog::NewL( 
                                                       ECFDDialogTypeNormal, 
                                                       ETrue );
           CleanupStack::PushL( dlg );
           returnValue = dlg-&gt;ExecuteL( iMemory );
</pre></div><p>
Then set the display text:<p>
<div class="fragment"><pre class="fragment">           <span class="keywordflow">if</span>( returnValue )
               {
               textMain.Append( KCommonDialogsExSelected );
               <span class="keywordflow">if</span> ( iMemory == CAknMemorySelectionSettingPage::EPhoneMemory )
                   {
                   textSub.Append( KCommonDialogsExPhoneMemoryName );
                   }
               <span class="keywordflow">else</span>
                   {
                   textSub.Append( KCommonDialogsExMemoryCardName );
                   }
               }
           <span class="keywordflow">else</span>
               {
               textMain.Append( KCommonDialogsExCanceled );
               textSub.Append( KCommonDialogsExSpace );
               }
           iAppContainer-&gt;ShowTextL( textMain, textSub );
           CleanupStack::PopAndDestroy(); <span class="comment">//dlg</span>
</pre></div><p>
(2) Creating Multiple Drive memory selection dialogs with case <code>ECommonDialogsExCmd102</code>.<p>
If your current SDK supports Multiple Drive APIs, the dialog will display:<p>
<div class="fragment"><pre class="fragment">           CAknMemorySelectionDialogMultiDrive* dlg =
               CAknMemorySelectionDialogMultiDrive::NewL(
                       ECFDDialogTypeNormal, ETrue );
           CleanupStack::PushL( dlg );
           returnValue = dlg-&gt;ExecuteL( iDrive , &amp;tempRootPath, NULL );
           ......
           CleanupStack::PopAndDestroy();
</pre></div><p>
(3) Creating memory settings dialog with case <code>ECommonDialogsExCmd201</code>:<p>
<div class="fragment"><pre class="fragment">           <a class="code" href="class_c_common_dialogs_ex_settings_dialog.html">CCommonDialogsExSettingsDialog</a>* dlg = 
                         <a class="code" href="class_c_common_dialogs_ex_settings_dialog.html#ba7832bd9403afb476264ec97fe67bf4">CCommonDialogsExSettingsDialog::NewL</a>(0, EFalse);
           dlg-&gt;ExecuteLD( R_COMMONDIALOGSEX_SETTINGS_DIALOG );
           textMain.Append( KCommonDialogsExSelected );
           textSub.Append( KCommonDialogsExDefaultSetting );
           iAppContainer-&gt;ShowTextL( textMain, textSub );
</pre></div><p>
(4) Creating Multiple Drive memory settings dialog with case <code>ECommonDialogsExCmd202</code>:<p>
<div class="fragment"><pre class="fragment">            <a class="code" href="class_c_common_dialogs_ex_settings_dialog.html">CCommonDialogsExSettingsDialog</a>* dlg =
                <a class="code" href="class_c_common_dialogs_ex_settings_dialog.html#ba7832bd9403afb476264ec97fe67bf4">CCommonDialogsExSettingsDialog::NewL</a>(0, ETrue);
            dlg-&gt;ExecuteLD( R_COMMONDIALOGSEX_SETTINGS_DIALOG );
            textMain.Append( KCommonDialogsExSelected );
            textSub.Append( KCommonDialogsExMultiSetting );
            iAppContainer-&gt;ShowTextL( textMain, textSub );
</pre></div><p>
(5) Creating file selection dialog with case <code>ECommonDialogsExCmd301</code>:<p>
<div class="fragment"><pre class="fragment">           CAknFileSelectionDialog* dlg = CAknFileSelectionDialog::NewL( ECFDDialogTypeSelect );
           CleanupStack::PushL( dlg );
           returnValue = dlg-&gt;ExecuteL( rootFileName );
           ......
           iAppContainer-&gt;ShowTextL( textMain, textSub );
           CleanupStack::PopAndDestroy();
</pre></div><p>
(6) Creating file name prompt dialog with case <code>ECommonDialogsExCmd401</code>:<p>
<div class="fragment"><pre class="fragment">           returnValue = CAknFileNamePromptDialog::RunDlgLD( 
                                 defaultFileName, 
                                 KRootPath );
           ......
           iAppContainer-&gt;ShowTextL( textMain, textSub );
</pre></div><p>
<hr>
<table x-use-null-cells
		style="x-cell-content-align: top;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;"
		cellspacing=0
		width=100%>
  <col style="width: 50%;">
  <col style="width: 50%;">

  <tr style="x-cell-content-align: top;"
	valign=top>
  <td style="width: 50%;
			padding-right: 10px;
			padding-left: 10px;
			border-right-style: None;
			border-left-style: None;
			border-top-style: None;
			border-bottom-style: None;"
	width=50%>
  <p style="font-family: Arial;"><small style="font-size: smaller;">© Nokia 2008</small></td>
  <td style="width: 50%;
			padding-right: 10px;
			padding-left: 10px;
			border-top-style: None;
			border-bottom-style: None;
			border-right-style: None;"
	width=50%>
  <p style="text-align: right; margin-right: -4px;"
	align=right><span style="font-weight: bold;"><a href="#Top"
													title="Back to top"><img
 src="top.gif"
	x-maintain-ratio=TRUE
	alt="Back to top"
	style="border: none;
			width: 18px;
			height: 15px;
			float: none;
			border-style: none;
			border-style: none;"
	width=18
	height=15
	border=0></a></span></td></tr>
 </table>
</body>
</html>


